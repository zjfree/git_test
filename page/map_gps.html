<!-- JS地图 zjfree 2019-08-08 -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>地图</title>

<link href="https://lib.baomitu.com/normalize/latest/normalize.min.css" rel="stylesheet">
<link href="../static/map/css/leaflet.css" id="theme" rel="stylesheet">

<style>
/* css style */
body, html{
	width:100%;
	height:100%;
	overflow: hidden;
}

#divMap{
	position: absolute;
	top:0;
	left:0;
	right:0;
	bottom:20px;
	background: #eff;
}

#divInfo{
	position: absolute;
	right:10px;
	bottom:0px;
	z-index: 1000;
	height:20px;
	font-size:12px;
	color:#000;
}
</style>

<script src="https://lib.baomitu.com/jquery/3.4.1/jquery.min.js"></script>
<script src="../static/map/js/leaflet.js"></script>
<script src="../static/map/js/leaflet.ChineseTmsProviders.js"></script>
<script src="../static/map/js/leaflet_map.js"></script>
<script src="../static/map/js/GpsConvert.js"></script>

</head>
<body>
<!-- 内容 -->
<div id="divMap"></div>
<div id="divInfo"></div>

<script>
var mapLayerList = SuperMap.getLayerList();
var map;
var index = 0;

var myMarker = null;

$(function(){
	// JS
	let centerGps = [34, 109];
    map = L.map("divMap", {
        center: centerGps,
        zoom: 10,
        layers: mapLayerList['google_Hybrid'],
        zoomControl: true,
        detectRetina: true,
    });

    L.control.scale({imperial:false}).addTo(map);
	L.control.layers(mapLayerList, null).addTo(map);
	
    // Geolocation
    map.locate({
		setView: true,
		maxZoom: 16,
		watch: true,
		enableHighAccuracy: true,
    });

    map.on('locationfound', function(e) {
		index++;
		let radius = e.accuracy / 2;
		let gps = GpsConvert.wgs84_gcj([e.latlng.lat, e.latlng.lng]);
		
		if (myMarker == null)
		{
			myMarker = L.circleMarker(gps, {radius:5, weight:1, color:'#fff', fillColor:'#4AFF59' fillOpacity:0.9}).addTo(map);	
		}
		else
		{
			myMarker.setLatLng(gps);
		}
		
		//map.flyTo(gps);

		$('#divInfo').css('color', '#000').html('(' + index + ') ' + gps.join(','));
    });

    map.on('locationerror', function(e) {
		$('#divInfo').css('color', 'red').html('error:' + e.message);
    });

    SuperMap.hideCompany();
});
</script>

<!-- 51啦访问统计 
<script type="text/javascript" src="//js.users.51.la/20254973.js"></script>
-->

</body>